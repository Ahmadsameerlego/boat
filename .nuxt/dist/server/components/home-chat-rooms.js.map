{"version":3,"file":"components/home-chat-rooms.js","sources":["webpack:///./components/home/ChatRooms.vue","webpack:///./components/home/ChatRooms.vue?70b4","webpack:///./components/home/ChatRooms.vue?1931","webpack:///./components/home/ChatRooms.vue?5d31","webpack:///./components/home/ChatRooms.vue?a6d4","webpack:///./components/home/ChatRooms.vue?228b"],"sourcesContent":["\nexport default {\n  data(){\n    return{\n      rooms : [],\n      room : {},\n      messages : [],\n      reversedMessages : [],\n      user_id: '',\n      delegate_id : '',\n      room_id : '',\n      sended_room : '',\n      showWindow : false,\n      showLoad : false,\n      messageText : '',\n      avatar : '',\n      fileChosen : \"\",\n      file : \"\",\n      type : '',\n      client : false,\n      provider : false\n    }\n  },\n  methods:{\n\n    // main send method => { check if the message is file or text }\n    addMessage(){\n      if( this.fileChosen !== \"\" ){\n        // upload file\n        let formData = new FormData();\n        formData.append(\"file\", this.file);\n        formData.append(\"type\", this.type);\n\n        // if message uploaded is file then send it \n        this.uploadFile(formData);\n      }\n      else if (this.messageText.trim() == \"\") {\n        return false;\n      } else {\n        // send text message\n        this.sendMessage(this.messageText, \"text\");\n      }\n\n    },\n    // upload file (request)\n    uploadFile(formData) {\n      // POST /someUrl\n      this.$axios\n        .$post(\"/upload-file\", formData, {\n          headers:{\n            Authorization:  `Bearer ${localStorage.getItem('token')}`\n        }\n        })\n        .then((response) => {\n          if (response.key == \"success\") {\n            this.fileChosen = \"\";\n\n            // send message here\n            this.sendMessage(\n              response.data.name,\n              \"file\",\n              response.data.url\n            );\n          }\n        });\n    },\n\n\n    // send message \n    sendMessage(msg , type , url){\n\n      let body = msg;\n      if (url != null) {\n        body = url;\n      }\n\n      if( this.client == true ){\n        this.$socket.emit(\"sendMessage\", {\n          sender_id: this.user_id,\n          sender_type: 'user',\n          avater: this.avatar,\n          receiver_id: this.delegate_id,\n          receiver_type: 'delegate',\n          room_id: this.room_id,\n          type: type,\n          content: body,\n          duration: 0,\n          created_at: new Date().toLocaleTimeString([], { hour: '2-digit', minute:'2-digit' }),\n        });\n      }else if( this.provider == true ){\n        this.$socket.emit(\"sendMessage\", {\n          sender_id: this.delegate_id,\n          sender_type: 'delegate',\n          avater: this.avatar,\n          receiver_id: this.user_id,\n          receiver_type: 'user',\n          room_id: this.room_id,\n          type: type,\n          content: body,\n          duration: 0,\n          created_at: new Date().toLocaleTimeString([], { hour: '2-digit', minute:'2-digit' }),\n        });\n      }\n\n      \n      \n\n\n      let user = localStorage.getItem('user');\n      this.avatar = JSON.parse(user).avatar ;\n      this.messages.push({\n        // created_at: date,\n        is_sender: 1,\n        // original_message: { body: body, type: $type },\n        avatar : this.avatar,\n        sent_by_me: true,\n        type: type,\n        content: body,\n        time:new Date().toLocaleTimeString([], { hour: '2-digit', minute:'2-digit' }),\n        fileChosen : this.fileChosen\n\n      });\n      // this.messages = this.messages.reverse();\n\n      this.messageText = \"\";\n      this.$nextTick(() => {\n          this.scrollToBottom();\n      });\n      \n      console.log(this.room_id)\n      console.log(this.user_id)\n      console.log(this.delegate_id)\n\n    },\n    // get rooms \n    async getChatRooms(){\n      await this.$axios.$get('/my-rooms?page=1', {\n        headers:{\n            Authorization:  `Bearer ${localStorage.getItem('token')}`\n        }\n      })\n      .then( (res)=>{\n        if( res.key == 'success' ){\n          this.rooms = res.data.rooms ;\n        }\n      } )\n    },\n    // get single room \n    async showRoom(room_id, user_id , delegate_id){\n      this.showWindow = true ;\n      this.showLoad = true ;\n      await this.$axios.$get(`/single-room?room_id=${room_id}&page=1`, {\n        headers:{\n            Authorization:  `Bearer ${localStorage.getItem('token')}`\n        }\n      })\n      .then( (res)=>{\n        if( res.key == 'success' ){\n          this.room = res.data.room ;\n          this.messages = res.data.room.messages ;\n\n          this.reversedMessages = this.messages.reverse()\n\n          this.showLoad = false ;\n\n          this.room_id = room_id;\n          this.user_id = user_id;\n          this.delegate_id = delegate_id;\n\n          this.$nextTick(() => {\n              this.scrollToBottom();\n          });\n\n\n          if( typeof localStorage !== 'undefined'  ){\n              let user = localStorage.getItem('user');\n              let user_id = JSON.parse(user).id;\n              let type = JSON.parse(user).acc_type;\n              this.$socket.emit(\"adduser\", {\n                user_id: user_id,\n                // delegate_id: 64,\n                room_id: this.room_id,\n                user_type : type\n              });\n            }\n        }\n      } )\n    },\n    closeWindow(){\n      this.showWindow = false\n    },\n    scrollToBottom(){\n      const chatSection = this.$refs.chatSection;\n      chatSection.scrollTop = chatSection.scrollHeight;\n    },\n    uploadImage(){\n      this.file = this.$refs.file.files[0];\n      this.fileChosen = URL.createObjectURL(this.file);\n      this.messageText = this.$refs.file.files[0].name;\n      this.type = this.$refs.file.files[0].type ;\n\n      console.log( this.fileChosen )\n    }\n\n\n  },\n  sockets: {\n    newMessage(data) {\n      // console.log('new message' ,data);\n      var date = new Date(data.created_at);\n      date.toLocaleString(\"en-US\", { timeZone: \"Asia/Riyadh\" });\n      this.messages.push({\n        sent_by_me: false,\n        type: data.type,\n        content: data.content,\n        date: date.toDateString(\"en-US\", { timeZone: \"Asia/Riyadh\" }),\n        time: this.formatAMPM(date),\n      });\n    },\n  },\n\n\n  beforeMount(){\n        this.getChatRooms()\n  },\n  mounted(){\n    // console.log(this.fileChosen)\n\n    this.$socket.on('connect', () => {\n      console.log('socket connect')\n    })\n\n    if( this.$route.fullPath.includes('client') ){\n      this.client = true ;\n    }else if( this.$route.fullPath.includes('provider') ){\n      this.provider = true ;\n    }\n\n\n  },\n\n\n\n  created(){\n    this.$socket.on('newMessage', (data) => {\n      console.log(data)\n      console.log('neeeeeeew messssssageeeeeee')\n      var date = new Date(data.created_at);\n      date.toLocaleString(\"en-US\", { timeZone: \"Asia/Riyadh\" });\n      this.messages.push({\n        sent_by_me: false,\n        type: data.type,\n        content: data.content,\n        date: date.toDateString(\"en-US\", { timeZone: \"Asia/Riyadh\" }),\n        time: data.created_at,\n      });\n\n    // this.messages = this.messages.reverse()\n    // this.scrollToBottom()\n    \n    })\n  },\n}\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js??ref--7-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatRooms.vue?vue&type=style&index=0&id=1f6a25ae&prod&lang=scss&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add CSS to SSR context\nvar add = require(\"!../../node_modules/vue-style-loader/lib/addStylesServer.js\").default\nmodule.exports.__inject__ = function (context) {\n  add(\"2f30454e\", content, true, context)\n};","export * from \"-!../../node_modules/vue-style-loader/index.js??ref--7-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js??ref--7-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatRooms.vue?vue&type=style&index=0&id=1f6a25ae&prod&lang=scss&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(function(i){return i[1]});\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".uploadFile{height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}.message_img{height:80px;width:80px}.status.open{background:#117211}.status.close,.status.open{border-radius:50%;height:12px;width:12px}.status.close{background:#a00e1a}.closeWindow{align-items:center;display:flex;height:25px;justify-content:center;width:25px}.chat_window{background:#fff;bottom:0;box-shadow:0 0 10px rgba(51,51,51,.271);height:320px;position:fixed;right:0;width:300px}.chat_window .window_body{height:212px;margin-top:12px;overflow-y:auto}.chat_window .window_body .created_at{color:#dfd2d2;font-size:12px}.chat_window .window_body .window_avatar{border-radius:50%;height:35px;width:35px}.chat_window .window_body .message_content{background:#ccc;border-radius:5px;color:#424040;font-size:13px;padding:5px}.window_footer{background:#fff;box-shadow:0 0 8px hsla(0,3%,53%,.239);width:100%}.window_footer .send{font-size:12px;height:30px;padding:0;width:81px}.window_footer textarea{font-size:12px;height:40px;width:122px}.window_footer textarea:focus{position:fixed;width:285px}.window_footer .upload{color:#ccc}.window_head{background:#111b5a;height:40px;padding-left:12px;padding-right:12px}.window_head .status{margin:0 5px}.name,.status{color:#fff}.dropdown-toggle:after{display:none}.btn-secondary{background:transparent;border:none}.room_avatar{border-radius:50%;height:40px;margin:0 7px;width:40px}.room_item{border-bottom:1px solid #ccc}.para{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:202px}.receive{flex-direction:row-reverse;width:100%}.dropdown-menu{max-height:400px;min-height:auto;overflow-y:auto}\", \"\"]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {};\nmodule.exports = ___CSS_LOADER_EXPORT___;\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatRooms.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatRooms.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ChatRooms.vue?vue&type=template&id=1f6a25ae&\"\nimport script from \"./ChatRooms.vue?vue&type=script&lang=js&\"\nexport * from \"./ChatRooms.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./ChatRooms.vue?vue&type=style&index=0&id=1f6a25ae&prod&lang=scss&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  null,\n  \"6d3ea0cb\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;ACtQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACXA;AAAA;AAAA;AAAA;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AHPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;AIFA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}